{set:$comment_total=$this->data['comment_total'];}
{set:$average_point=$this->data['average_point'];}
{set:$id=intval(IReq::get('id'));}
{set:$item=Api::run('getGoodsInfo',array("#id#",$id))}
{if:!$item}
{set:IError::show(403,'商品信息不存在')}
{/if}
<div class="position"> <span>您当前的位置：</span> <a href="{url:}"> 首页</a> » <a href="{url:/site/products/id/$id}" target="_blank">评论</a> </div>
<div class="wrapper clearfix">
	<div class="sidebar f_l">
		<div class="box_2 m_10">
			<div class="title">商品信息</div>
			<div class="content" style='width:95%;'>
				<ul class="prolist clearfix">
					<li>
						<a href="{url:/site/products/id/$id}" target="_blank"><img src="{url:/pic/thumb/img/$item[img]/w/212/h/167}" title="{$item['name']}" alt="{$item['name']}"  width="167"></a>
						<p class="pro_title">商品名称：<a class="blue" href="{url:/site/products/id/$id}" target="_blank">{$item['name']}</a></p>
						<p>优惠价：<b>{$item['sell_price']}</b></p>
						<p>评价得分：<span class="grade"><i style="width:{echo:Common::gradeWidth($average_point)}px"></i></span>({$average_point}分)</p>
						<p>评论数：{$comment_total}条</p>
					</li>
					<input type="submit" onclick="joinCart_list({$id});" value="加入购物车" class="submit_join m_10">
				</ul>
			</div>
		</div>
	</div>

	<div class="main comment_list f_r" style='width:930px;'>
		<div class="tabs">
			<div class="tabs_menu uc_title">
				<label><span><a href="{url:/site/comments_list/id/$id}">全部评论({$comment_total}条)</a></span></label>
				<label><span><a href="{url:/site/comments_list/id/$id/type/good}">好评({$this->data['point_grade']['good']}条)</a></span></label>
				<label><span><a href="{url:/site/comments_list/id/$id/type/middle}">中评({$this->data['point_grade']['middle']}条)</a></span></label>
				<label><span><a href="{url:/site/comments_list/id/$id/type/bad}">差评({$this->data['point_grade']['bad']}条)</a></span></label>
			</div>

			<div class="tabs_content">
				{foreach:items=$this->data['comment_list'] key=$key item=$item}
				<div class="node item">
					<div class="user">
						<div class="ico"><img src="{webroot:$item[head_ico]}" width="70px" height="70px" onerror="this.src='{skin:images/front/user_ico.gif}'" /></div>
						<a class="blue">{$item['username']}</a>
						<p class="gray">{$item['user_group_name']}</p>
						<p class="gray"></p>
					</div>
					<dl class="desc">
						<p class="clearfix"><b>评分：</b><span class="grade"><i style="width:{echo:Common::gradeWidth($item['point'])}px"></i></span><span class="light_gray">{$dateline}</span><label></label></p>
						<hr />
						<p class="fl_tpiu"><b>评语：</b><span class="gray">{$item['contents']}</span></p>
                        {if: $item['photo']}
                        <p class="js_photo">
                        {foreach: items=$item['photo'] item=$photo}
                            <img src="{webroot:$photo['img']}" class="js_show_big_photo"/>
                        {/foreach}                      
                        <p></p>
                        {/if}
                     {if:isset($item['replySelf'])}
                     <p class="zhuipng"><b>追加评语：</b><span class="gray">{$item['replySelf']['contents']}</span></p>
                        {if: isset($item['replySelfPhoto'])}
                        <p class="js_photo">
                        {foreach: items=$item['replySelfPhoto'] item=$photo}
                            <img src="{webroot:$photo['img']}" class="js_show_big_photo"/>
                        {/foreach}                      
                        <p></p>
                        {/if}
                      {/if}
					</dl>
					<div class="corner b"></div>
					<div class="corner tl"></div>
				</div>
				<hr />
				{/foreach}
			</div>
			{$this->comment_query->getPageBar()}
		</div>
	</div>
</div>
<style type="text/css">
    .js_show_big_photo{
        width: 50px; height: 50px; border: 2px solid #F0F0F0;
    }
    .js_show_big_photo:hover{
         border: 2px solid #FF6600;
    }
</style>
<script type='text/javascript'>
//DOM加载完毕
$(function()
{
	//tab标签的class设置
	var urlType  = "{echo:IReq::get('type') ? IReq::get('type') : 'all'}";
	var tabIndex = {"all":0,"good":1,"middle":2,"bad":3};
	$('.tabs_menu>label:eq('+tabIndex[urlType]+')').addClass('current');
});
$(document).on('click', '.js_show_big_photo', function(){
    var _u = new Image();
    _u.src = $(this).attr('src')
    var _w = _u.width > 500 ? 500 : _u.width
        ,html = '<p class="js_hide_big_photo" style="margin-top:10px;width:26px; height:20px; border:1px solid gray;cursor:pointer;">关闭</p><br/><img src='+_u.src+' width='+_w+'/>';
    $(this).parents('.js_photo').next('p').html(html);
})
$(document).on('click', '.js_hide_big_photo', function(){
    $(this).parents('p').html('');
})
</script>
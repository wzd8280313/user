{set:$seo_data=array(); $site_config=new Config('site_config');}
{set:$seo_data['title'] = $this->catRow['title']?$this->catRow['title']:$this->catRow['name']}
{set:$seo_data['title'].="_".$site_config->name}
{set:$seo_data['keywords']=$this->catRow['keywords']}
{set:$seo_data['description']=$this->catRow['descript']}
{set:seo::set($seo_data);}
{set:$breadGuide = goods_class::catRecursion($this->catId)}
{set:$goodsObj = search_goods::find(array('category_extend' => $this->childId));
$resultData = $goodsObj->find();
$seller = new IModel('seller');
$seller_arr = array();
$seller_arr[0]='平台自营';
}

{foreach:items =$resultData}
	{if:!isset($seller_arr[$item['seller_id']])}
	{set:$seller_arr[$item['seller_id']]=$seller->getField('id='.$item['seller_id'],'true_name')}
	{/if}
{/foreach}
<div class="position">



<div class="breadcrumb">
        <div class="crumbs-bar clearfix">
            <div class="crumbs-nav">
                <div class="crumbs-nav-main clearfix">
                    <div class="crumbs-nav-item one-level"> <a href="javascript;:" class="crumbs-link">首页</a> </div>
                    {foreach:items=$breadGuide item=$cate}
                    <div class="crumbs-nav-item">
                    <i class="crumbs-arrow" style="float: left;margin-right: 10px">&gt;</i>
                        <div class="menu-drop">
                            <div class="trigger"><span class="curr">{$cate['name']}</span><i class="menu-drop-arrow"></i></div>
                            <div class="menu-drop-main">
                                <ul class="menu-drop-list">
                                    {foreach:items=$cate['cate']}
                                    <li><a href="{url:/site/pro_list/cat/$item[id]}">{$item['name']}</a></li>
                                    {/foreach}
                                </ul>
                            </div>
                        </div></div>
                    {/foreach}
                    <!-- navExpands start -->
                    <!--<div class="crumbs-nav-item">
                        <div class="selector-set">
                            <a class="ss-item" title="七匹狼（SEPTWOLVES） " href="" >
                                <b>品牌： </b>
                                <em>七匹狼（SEPTWOLVES）</em>
                                <i></i>
                            </a>
                        </div>
                    </div>
                    <a class="btn btn-default fr" href="">全部撤消</a> -->  <!-- 不用就删掉 -->
                </div>
            </div>
        </div>
    </div>
</body>


<script type"text/javascript" src="{theme:javascript/navbar.js}"></script>











	<!-- <span>您当前的位置：</span>
	<a href="{url:}">首页</a>
	    {foreach:items=$breadGuide item=$cate} »
	    <div style="display: inline-block;"> 
	    <a href="{url:/site/pro_list/cat/$cate[id]}" class="js_show_on_off">{$cate['name']}</a>
	    <ul style="display: none;">
	    {foreach:items=$cate['cate']}
	    <li><a href="{url:/site/pro_list/cat/$item[id]}">{$item['name']}</a></li>
	    {/foreach}
	    </ul>
	    </div>
	    {/foreach} -->
</div>
<script type="text/javascript">
$(function(){
    $('.js_show_on_off').each(function(){
        $(this).hover(function(){
            $(this).next('ul').show();
        },function(){
            $(this).next('ul').hide();
        })
    })
})
</script>
<div class="wrapper clearfix container_2">
	

	<div class="main f_r">
		<!--推荐商品-->
		{set:$pro_list = Api::run('getCategoryExtendByCommendid',array('#childId#',$this->childId))}
	  	{if:$pro_list}
		<div class="brown_box m_10 clearfix">
			<p class="caption"><span>推荐</span></p>

			<ul class="prolist">
				{foreach:items=$pro_list}
				<li>
					<a class="pic" href="{url:/site/products/id/$item[id]}" target="_blank"><img src="{url:/pic/thumb/img/$item[img]/w/85/h/85}" height="85px" width="85px"></a>
					<p class="pro_title"><a class="blue" href="{url:/site/products/id/$item[id]}" target="_blank">{$item['name']}</a><span class="gray">{$item['description']}</span></p>
					<p><b>￥{$item['sell_price']}</b> <s>￥{$item['market_price']}</s></p>
				</li>
				{/foreach}
			</ul>
		</div>
		{/if}
				<!--推荐商品-->

		<!--商品条件检索-->
		<div class="box m_10">
			<div class="title">{$this->catRow['name']}</div>
			<div class="cont">

				<!--品牌展示-->
				{set:$brandList = search_goods::$brandSearch}
				{if:$brandList}
				<dl class="sorting">
					<dt>品牌：</dt>
					<dd id='brand_dd'>
						<a class="nolimit current" href="{echo:search_goods::searchUrl('brand','')}">不限</a>
						{foreach:items = $brandList}	
						<a href="{echo:search_goods::searchUrl('brand',$item['id'])}" id='brand_{$item['id']}'>{$item['name']}</a>
						{/foreach}
						</dd>
				</dl>
				{/if}				
				<!--品牌展示-->

				<!--商品属性-->
				{set:$attrSearch = search_goods::$attrSearch;$modelSearch = search_goods::$modelSearch}
		
				{if: !empty($attrSearch)}
					{foreach:items = $attrSearch}
					<dl class="sorting">
						<dt>{$item['name']}：</dt>
						<dd id='attr_dd_{$item['id']}'>
							<a class="nolimit current" href="{echo:search_goods::searchUrl('attr['.$item["id"].']','')}">不限</a>
							{foreach:items=$item['value'] item=$attr}
							<a href="{echo:search_goods::searchUrl('attr['.$item["id"].']',$attr)}" id="attr_{$item['id']}_{echo:md5($attr)}">{$attr}</a>
							{/foreach}
						</dd>
					</dl>
					{/foreach}
				{elseif: !empty($modelSearch)}
						<dl class="sorting">
							<dt>分类：</dt>
							<dd >
								<a class="nolimit current" >不限</a>
								
								{foreach:items=$modelSearch }
								{set:$id=(int)$item['id']}
								<a href="{echo:search_goods::searchUrl(array('1'=>'model'),$id)}" id="model_{$item['id']}">{$item['name']}</a>
								{/foreach}
							</dd>
						</dl>

				{/if}
				<!--商品属性-->

				<!--商品价格-->
				<dl class="sorting">
					<dt>价格：</dt>
					<dd id='price_dd'>
						<p class="f_r"><input type="text" class="mini" name="min_price" value="{echo:IFilter::act(IReq::get('min_price'),'url')}" onchange="checkPrice(this);"> 至 <input type="text" class="mini" name="max_price" onchange="checkPrice(this);" value="{echo:IFilter::act(IReq::get('max_price'),'url')}"> 元
						<label ><input  class='btn_gray btn_mini' type="button" onclick="priceLink();" value="确定"></label></p>
						<a class="nolimit current" href="{echo:search_goods::searchUrl(array('min_price','max_price'),'')}">不限</a>
						{foreach:items=search_goods::$priceSearch}
						{set:$priceZone = explode('-',$item)}
						<a href="{echo:search_goods::searchUrl(array('min_price','max_price'),array($priceZone[0],$priceZone[1]))}" id="{$priceZone[0]}-{$priceZone[1]}">{$item}</a>
						{/foreach}
					</dd>
				</dl>
				<!--商品价格-->
			</div>
		</div>
		<!--商品条件检索-->

		<!--商品列表展示-->
		<div class="display_title">
		<!--<span class="l"></span>
			<span class="r"></span> -->
			<span class="f_l">排序：</span>
			<ul>
				{foreach:items=search_goods::getOrderType()}
				{set:$next = search_goods::getOrderValue($key)}
				<li class="{echo:search_goods::isOrderCurrent($key) ? 'current':''}">
					<span class="l"></span><span class="r"></span>
					<a href="{echo:search_goods::searchUrl('order',$next)}">{$item}<span class="{echo:search_goods::isOrderDesc() ? 'desc':''}">&nbsp;</span></a>
				</li>
				{/foreach}
			</ul>
			<span class="f_l">显示方式：</span>
			<a class="show_b" href="{echo:search_goods::searchUrl('show_type','win')}" title='橱窗展示' alt='橱窗展示'><span class='{echo:search_goods::getListShow(IReq::get('show_type')) == 'win' ? 'current':''}'></span></a>
			<a class="show_s" href="{echo:search_goods::searchUrl('show_type','list')}" title='列表展示' alt='列表展示'><span class='{echo:search_goods::getListShow(IReq::get('show_type')) == 'list' ? 'current':''}'></span></a>
		</div>

			{if:$resultData}
			{set:$listSize = search_goods::getListSize(IFilter::act(IReq::get('show_type')));$showType=search_goods::getListShow(IFilter::act(IReq::get('show_type')))}
			<ul class="display_list clearfix m_10">
				{foreach:items=$resultData}
				<li class="clearfix  {$showType}">
					<div class="pic">
						<a title="{$item['name']}" href="{url:/site/products/id/$item[id]}" target="_blank"><img src="{url:/pic/thumb/img/$item[img]/w/$listSize[width]/h/$listSize[height]}" width="{$listSize['width']}" height="{$listSize['height']}" alt="{$item['name']}" width="200" height="200" alt="{$item['name']}" title="{$item['name']}" /></a>
					</div>
					<h3 class="title"> <span style='display:inline;color:red;'>{if:$item['is_del']==4}[预售]{/if}</span><a style='display:inline;' title="{$item['name']}" class="p_name" href="{url:/site/products/id/$item[id]}" target="_blank">{$item['name']}</a>
						<span>总销量：{$item['sale']}<a class="blue" href="{url:/site/comments_list/id/$item[id]}" target="_blank">( {$item['comments']}人评论 )</a></span>
						<span class='grade'><i style="width:{echo:Common::gradeWidth($item['grade'],$item['comments'])}px"></i></span>
						<span style='margin-top:2px;'>
							<a  style='margin-left:5px;text-decoration:none;'>{$seller_arr[$item['seller_id']]}</a>
						</span>
					</h3>
						
					<div class="price">￥{$item['sell_price']}<s>￥{$item['market_price']}</s></div>
				
				</li>
				{/foreach}
			</ul>
		{$goodsObj->getPageBar()}

		{else:}
		<p class="display_list mt_10" style='margin-top:50px;margin-bottom:50px'>
			<strong class="gray f14">对不起，没有找到相关商品</strong>
		</p>
		{/if}	<!--商品列表展示-->

	</div>
</div>
<script type='text/javascript'>
//价格跳转
function priceLink()
{
	var minVal = $('[name="min_price"]').val();
	var maxVal = $('[name="max_price"]').val();
	if(isNaN(minVal) || isNaN(maxVal))
	{
		alert('价格填写不正确');
		return '';
	}
	var urlVal = "{echo:IFilter::act(preg_replace('|&min_price=\w*&max_price=\w*|','',search_goods::searchUrl(array('min_price','max_price'),'')),'url')}";
	window.location.href=urlVal+'&min_price='+minVal+'&max_price='+maxVal;
}

//价格检查
function checkPrice(obj)
{
	if(isNaN(obj.value))
	{
		obj.value = '';
	}
}

//筛选条件按钮高亮
jQuery(function(){
	{set:
		$brand = IFilter::act(IReq::get('brand'),'int');
	}

	{if:$brand}
	$('#brand_dd>a').removeClass('current');
	$('#brand_{$brand}').addClass('current');
	{/if}

	{set:$tempArray = IFilter::act(IReq::get('attr'),'url')}
	{if:$tempArray}
		{set:$json = JSON::encode(array_map('md5',$tempArray))}
		var attrArray = {$json};
		for(val in attrArray)
		{
			if(attrArray[val])
			{
				$('#attr_dd_'+val+'>a').removeClass('current');
				document.getElementById('attr_'+val+'_'+attrArray[val]).className = 'current';
			}
		}
	{/if}

	{if:IReq::get('min_price') != ''}
	$('#price_dd>a').removeClass('current');
	$('#{echo:IReq::get('min_price')}-{echo:IReq::get('max_price')}').addClass('current');
	{/if}
});
</script>
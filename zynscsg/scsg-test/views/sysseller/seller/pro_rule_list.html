{set:$seller_id = $this->seller['seller_id'];}
{set:$search = IReq::get('name');$where = $search ? " and name=".$search : "";}
<article class="module width_full">
    <header>
        <h3 class="tabs_involved">促销活动列表</h3>
        <ul class="tabs">
            <li><input type="button" class="alt_btn" onclick="window.location.href='{url:/seller/pro_rule_edit}';" value="添加活动" /></li>
            <li><input type="button" class="alt_btn" onclick="selectAll('id[]');" value="全选" /></li>
            <li><input type="button" class="alt_btn" onclick="delModel();" value="批量删除" /></li>
            <li><input type="button" class="alt_btn" onclick="filterResult();" value="检索" /></li>
        </ul>
    </header>

    <form method='post' action='{url:/seller/pro_rule_del}'>
        <table class="tablesorter" cellspacing="0">
            <colgroup>
                <col width="40px" />
                <col width="150px" />
                <col width="280px" />
                <col width="60px" />
                <col />
                <col width="100px" />
            </colgroup>

            <thead>
                <tr>
                    <th>选择</th>
                    <th>名称</th>
                    <th>活动时间</th>
                    <th>状态</th>
                    <th>介绍</th>
                    <th>操作</th>
                </tr>
            </thead>

            <tbody>
                {set:$page= (isset($_GET['page'])&&(intval($_GET['page'])>0))?intval($_GET['page']):1;}
                {query:name=promotion where=type eq 0 $where and seller_id eq $seller_id  page=$page}
                <tr>
                    <td><input type='checkbox' name='id[]' value='{$item['id']}' /></td>
                    <td>{$item['name']}</td>
                    <td>{$item['start_time']} ～ {$item['end_time']}</td>
                    <td>{echo:($item['is_close']==1) ? '关闭': (($item['is_close']==2) ? '待审核' : '开启')}</td>
                    <td>{$item['intro']}</td>
                    <td>
                        <a href='{url:/seller/pro_rule_edit/id/$item[id]}'>
                            <img src="{skin:images/main/icn_edit.png}" alt="修改" title="修改" />
                        </a>

                        <a href='javascript:void(0)' onclick="delModel({link:'{url:/seller/pro_rule_del/id/$item[id]}'});">
                            <img src="{skin:images/main/icn_del.png}" alt="删除" title="删除" />
                        </a>
                    </td>
                </tr>
                {/query}
            </tbody>
        </table>
    </form>
    {$query->getPageBar()}
</article>
<script type="text/html" id="filterTemplate">
<form action="{url:/}" method="get" name="filterForm">
    <input type='hidden' name='controller' value='seller' />
    <input type='hidden' name='action' value='pro_rule_list' />
    <div class="module_content">
        <fieldset>
            <label>活动名称：</label>
            <input type="text" name="name" value="" />
        </fieldset>
    </div>
</form>
</script>

<script type="text/javascript">
//检索商品
function filterResult()
{
    var filterTemplate = template.render('filterTemplate');
    art.dialog(
    {
        "init":function()
        {
            var filterPost = {echo:JSON::encode(IReq::get('name'))};
            var formObj = new Form('filterForm');
            for(var index in filterPost)
            {
                formObj.setValue(index,filterPost);
            }
        },
        "title":"检索条件",
        "content":filterTemplate,
        "okVal":"立即检索",
        "ok":function(iframeWin, topWin)
        {
            iframeWin.document.forms[0].submit();
        }
    });
}
</script>